---
title: "occUncertain-vignette"
author: "Samuel Chang & Matthew Aiello-Lammens"
date: "5/3/2024"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{occUncertain-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo=F, include = FALSE}
library(occUncertain)
data(Leopardus_wiedii_gbif)
```



*****
*****
# 1. Introduction

This vignette goes through the use of uncertainty measures of species occurrence records in "occUncertainty: An R package for addressing uncertainty of species occurrence in species distribution". Here we demonstrate how **occUncertain** can be used to transform uncertainty measures from meters to decimal degrees. Perform iterations to assess occurrence records variability in the quantification of the extent area that encompass the inferred or projected sites of occurrence of a species, and the area within the extent polygon they occupy. 

## Input file

To demonstrate the use of the package `occUncertain` we used a set of 229 verified, georeferenced occurrence records for the margay (*Leopardus weidii*), a small wild cat native to Central and South America. These occurrences data set are from the Global Biodiversity Information Facility (GBIF) and are included as part of the `occUncertain` package.

<!---
Should re-download these data and get the citation to go with it.
--->

The data set includes the following four columns: 

1. Latitude in decimal degrees
1. Longitude in decimal degrees
1. Coordinate uncertainty in meters.
1. Name of taxa

```{r TableData,include=TRUE, echo=FALSE}
#Leopardus_wiedii_gbif <- dplyr::select(Leopardus_wiedii_gbif, latitude, longitude, coordinateUncertaintyInMeters, species)
knitr::kable(head(Leopardus_wiedii_gbif))
```

# 2. `meters_to_decdeg` function

The function `meters_to_decdeg` transforms uncertainty from meters into decimal degrees for each occurrence point. 

***Note 1*: Is important to consider the fact that as one moves away from the equator towards a pole, one degree of longitude is multiplied by the cosine of the latitude, decreasing the distance, approaching zero at the pole.  

The function allows interpretation of NA uncertainty values through the conditional parameter `na_action`. 

The options are:

## 1. **NA as Zero**, assigns zero to all NA values,
```
Unc_Meters_to_DecDeg_NAZero <-
  meters_to_decdeg(
    occs_df,
    lat_col = "latitude",
    lon_col = "longitude",
    coord_uncert = "coordinateUncertaintyInMeters",
    na_action = "NA as 0"
    )
```

```{r uncertainty from meter to radian degrees NA as 0, echo=FALSE}
L_wiedii_uncertainty_naZero <-
  meters_to_decdeg(occs_df = Leopardus_wiedii_gbif,
    lat_col = "latitude",
    lon_col = "longitude",
    coord_uncert = "coordinateUncertaintyInMeters",
    na_action = "NA as 0")

knitr::kable(head(L_wiedii_uncertainty_naZero))
```

## 2. **NA as NA**, leaves NA values as NA, and 
```
Unc_Meters_to_DecDeg_NANA <-
  meters_to_decdeg(
    occs_df,
    lat_col = "latitude",
    lon_col = "longitude",
    coord_uncert = "coordinateUncertaintyInMeters",
    na_action = "NA as NA"
    )
```

```{r uncertainty from meter to radian degrees NA as NA, echo=FALSE}
L_wiedii_uncertainty_naNA <-
  meters_to_decdeg(occs_df = Leopardus_wiedii_gbif,
    coord_uncert = "coordinateUncertaintyInMeters",
    na_action = "NA as NA")

knitr::kable(head(L_wiedii_uncertainty_naNA))
```

## 3. **NA as Mean**, assigns the uncertainty mean value to NA latitude and longitude values.
```
Unc_Meters_to_DecDeg_NAMean <-
  meters_to_decdeg(
    occs_df,
    lat_col = "latitude",
    lon_col = "longitude",
    coord_uncert = "coordinateUncertaintyInMeters",
    na_action = "NA as mean"
    )
```

```{r uncertainty from meter to radian degrees NA as mean, echo=FALSE}
L_wiedii_uncertainty_naMean <-
  meters_to_decdeg(occs_df = Leopardus_wiedii_gbif,
    coord_uncert = "coordinateUncertaintyInMeters",
    na_action = "NA as mean")

knitr::kable(head(L_wiedii_uncertainty_naMean))
```

# 3. `create_occ_uncertain_data` function

The `create_occ_uncertain_data` function creates a new data frame in which the latitude and longitude coordinates have been randomly jittered based on the coordinate uncertainty values.
Each occurrence point coordinate is given uncertainty values using the `meters_to_decdeg` function, and as such, the `na_action` choice will be applied.

Here we create a new jittered data frame using the `na_as_mean` option:

```{r}
L_wiedii_uncertain_df_naMean <-
  create_occ_uncertain_data(occs_df = Leopardus_wiedii_gbif, 
                            lat_col = "latitude", lon_col = "longitude", 
                            coord_uncert = "coordinateUncertaintyInMeters", 
                            na_action = "NA as mean")
```




## L. wiedii observed and generated occurrences

```{r echo=FALSE, fig.width = 10, fig.height= 10}
library(ggplot2)

#observed data
ggplot2::ggplot() +
  geom_polygon(data = ggplot2::map_data("world"),
               aes(x = long, y = lat, group = group),
               fill = NA,
               colour = "grey"
  ) +
  coord_fixed(xlim = c(-85,-70), ylim = c(-5, 10)) +
  geom_point(data = Leopardus_wiedii_gbif,
             aes(x = longitude, y = latitude,
                 colour = "Observed occ"),
             fill = NA,
             shape = 1,
             alpha = 0.8
  ) +
  geom_point(data = L_wiedii_uncertain_df_naMean,
             aes(x = lon_random, y = lat_random,
                 colour = "NA as Mean"),
             #size = 0.01,
             #fill = NA,
             shape = 3,
             alpha = 0.5
  ) +
  scale_colour_manual(
    "",
    values = c(
      "Observed occ" = "blue",
      "NA as Mean" = "red"
    )
  ) +
  theme_bw()


```
  
    

