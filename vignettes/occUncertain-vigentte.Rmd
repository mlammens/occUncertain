---
title: "occUncertain-vigentte"
author: "Samuel Chang"
date: "3/5/2020"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{occUncertain-vigentte}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

This vignette goes through the use of uncertainty meassures of species occurrence records in "occUncertainty: An R package for addressing uncertainty of species occurrence in species distribution models". Here we demostrate how *occUncertain* can be used to transform uncertainty meassures from meters to decimal degrees, how many repetitions of the repetitions of the mutating algorithm are necessary to accurately achieve occurrence records, and we examine whether there is a notable variability in the quantification of the extent area that encompass the inferred or projected sites of occurrence of a species, and the area within the extent polygon they occupy. 

#1 Load the occUncertain R package
Here we load the R package from source code. This source code will soon be submitted to CRAN, so that this package can be loaded using standard package management methods.

```{r}
library(occUncertain)
```

##1.1 Example dataset

To demonstrate the use of the package occUncertain we used a set of 229 verified, georeferenced occurrence records for the margay (*Leopardus weidii*) a small wild cat native to Central and South America. These occurrences dataset are from the Global Biodiversity Information Facility  (GBIF) and are included as part of the occUncertain package.

##Load dataset 

```{r dataset, eval = FALSE}
library(readr)
Leopardus_wiedii_gbif <- data(Leopardus_wiedii_gbif)

save(Leopardus_wiedii_gbif)
  read_csv("C:/Users/Samuel/changalfsam@ Google Drive/Samuel Chang - M.Sc Project/occUncertain/data/Leopardus_wiedii_gbif.csv")

```

Lets take a look into the data set, it is required to have at least three columns: latitude, longitude and the coordinate uncertainty. In this case the uncertainty is expresed in meters and our coodinates are in WSG84. 

```{r head}
head(Leopardus_wiedii_gbif)
```

The function **meters_to_decdeg** transforms the units into radian degrees for each occurence point. Its impotant to consider the fact that as one moves away from the equator towards a pole, one degree of longitude is multiplied by the cosine of the latitude, decreasing the distance, approaching zero at the pole.  

In case of having an NA values for the uncertaity, the function includes a parameter *na_action*; which enacts distance options for NA values. The options are "NA as zero" , "NA as mean", and "NA as NA".

```{r uncertainty from meter to radian degrees NA as 0}
Leopardus_wiedii_uncertainty_naZero <- meters_to_decdeg(Leopardus_wiedii_gbif, distance = "coordinateUncertaintyInMeters", na_action = "NA as 0")
head(Leopardus_wiedii_uncertainty_naZero)

```

```{r uncertainty from meter to radian degrees NA as mean}
Leopardus_wiedii_uncertainty_naMean <- meters_to_decdeg(Leopardus_wiedii_gbif, distance = "coordinateUncertaintyInMeters", na_action = "NA as mean")
head(Leopardus_wiedii_uncertainty_naMean)

```

```{r uncertainty from meter to radian degrees NA as NA}
Leopardus_wiedii_uncertainty_naNA <- meters_to_decdeg(Leopardus_wiedii_gbif, distance = "coordinateUncertaintyInMeters", na_action = "NA as NA")
head(Leopardus_wiedii_uncertainty_naNA)

```

# Set the projection of the original data, and then use spTransform the coordinates into UTM 

---
proj4string(Leopardus_wiedii) <- CRS("+proj=utm + ellps=WGS84") # This sets the projection of the data, assuming that you are using the WGS84 ellipsoid (if you do not know for sure, it is a safe assumption)

data <-spTransform(data,CRS="+proj=utm +zone=27 +datum=WGS84") # Use whatever UTM zone you need.
crs(data)

data <- as.data.frame(coordinates(data)) # This converts the SpatialPoints object back into a data frame
data <- data
---

To utilize the function 

## Randomize

For the rest of the example we will use the na_action = "NA as mean"

The function **generate_occ_uncertain**, generates random occurrence latitude and longitude coordinates with uncertain values. The function requires to have a data.frame with at least four columns - latitude, longitude, latitude uncertainty and longitude uncertainty in decimal degrees.

```{r combine}
Leopardus_wiedii <- cbind(Leopardus_wiedii_gbif, Leopardus_wiedii_uncertainty_naMean)
head(Leopardus_wiedii)
```

Lets generate random occurrence latitude and longitude coordinates with uncertain values. 

```{r generate}

Leopardus_wiedii_random <- generate_occ_uncertain(Leopardus_wiedii, lat_col = , lat_uncertainty = "lat_uncertainty", lon_uncertainty = "lon_uncertainty")
```

after we generate the new random ocurences cal in any packages we want to use for AOO and EOO. 


```{r}
plot(Leopardus_wiedii$longitude, Leopardus_wiedii$latitude)
points(Leopardus_wiedii_random$lon_random, Leopardus_wiedii_random$lat_random, col = "red", pch = 21)
```
----

#3 Computing EOO 

The Extent of Occurrence (EOO) is the area contained within the shortest continuous imaginary boundary which can be drawn to encompass all the known, inferred or projected sites of present occurrence of a taxon, excluding cases of vagrancy. (IUCN 2012)

#3.1 Input file 

Is is required a data frame with at least three different columns: 

```{r file}
Leopardus_wiedii_random$tax <- c('Leopardus_weidii')

head(Leopardus_wiedii_random)
```
1. lat_random: Latitude in decimal degrees
2. lon_random: Longitude in decimal degrees
3. Name of taxa

```{r EOO}
L_weidii_EOO <- EOO.computing(Leopardus_wiedii_random)

EOO.computing(Leopardus_wiedii_random, export_shp = T)

plot(L_weidii_EOO$spatial.polygon_1, col = "grey") #need finite 'xlim' values

```

3.2 Cropping spatial polygon for excluding unsuitable area

You may want to exclude areas that are not suitable for your species when computing EOO. This is feasible using the logical argument exclude.area which will crop areas defined by the shapefile you provide with the argument country_map. Note that it is mandatory to provide a shapefile for country_map if exclude.area is TRUE. 

```{r excluding unsuitable area}
#ConR provides the land world cover. Ocean cover is therefore excluded when computing EOO.
EOO.computing(Leopardus_wiedii_random, exclude.area = T, country_map = land)

#Overlapping hull convex with the ocean cover:
EOO.computing(Leopardus_wiedii_random, exclude.area = F, country_map = land)
```


#4 Computing AOO 
(AOO) is calculatlaed as the area of all known or predicted cells for the species. The resolution will be 2x2km as required by IUCN.

Area of occupancy (AOO), is the area occupied by a taxon within its extent of occurrence. The measure reflects the fact that a taxon will not usually occur throughout the area of its extent of occurrence, which may contain unsuitable or unoccupied habitats.

```{r AOO}

library(ConR)

L_weidii_AOO <- AOO.computing(Leopardus_wiedii_random)

```

#Runing IUCN.eval function 

```{r IUCN}

IUCN.eval(Leopardus_wiedii_random)
```
